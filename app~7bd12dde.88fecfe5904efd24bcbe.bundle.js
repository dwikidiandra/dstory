"use strict";(self.webpackChunkapp_starter_project_with_webpack=self.webpackChunkapp_starter_project_with_webpack||[]).push([[71],{24:(e,r,t)=>{t.d(r,{A:()=>f});var n=t(848),o=t(467),a=t(29),s=t(901),c=t(756),i=t.n(c),u=t(148),p=t(559);function l(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function h(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?l(Object(t),!0).forEach((function(r){(0,n.A)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}const f=new(function(){return(0,s.A)((function e(){(0,a.A)(this,e),this._dbPromise=this._initDb()}),[{key:"_initDb",value:(l=(0,o.A)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.P2)(p.A.BOOKMARK_DATABASE_NAME,p.A.DATABASE_VERSION,{upgrade:function(e){e.objectStoreNames.contains(p.A.BOOKMARK_OBJECT_STORE_NAME)||e.createObjectStore(p.A.BOOKMARK_OBJECT_STORE_NAME,{keyPath:"id"})}}));case 1:case"end":return e.stop()}}),e)}))),function(){return l.apply(this,arguments)})},{key:"getAllBookmarks",value:(c=(0,o.A)(i().mark((function e(){var r,t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._dbPromise;case 3:return r=e.sent,e.next=6,r.getAll(p.A.BOOKMARK_OBJECT_STORE_NAME);case 6:return t=e.sent,e.abrupt("return",t||[]);case 10:return e.prev=10,e.t0=e.catch(0),console.error("Error getting bookmarks:",e.t0),e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return c.apply(this,arguments)})},{key:"getBookmark",value:(n=(0,o.A)(i().mark((function e(r){var t,n,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._dbPromise;case 3:return t=e.sent,n=t.transaction(p.A.BOOKMARK_OBJECT_STORE_NAME,"readonly"),o=n.objectStore(p.A.BOOKMARK_OBJECT_STORE_NAME),e.abrupt("return",o.get(r));case 9:throw e.prev=9,e.t0=e.catch(0),console.error("Error getting bookmark:",e.t0),e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e){return n.apply(this,arguments)})},{key:"addBookmark",value:(t=(0,o.A)(i().mark((function e(r){var t,n,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._dbPromise;case 3:return t=e.sent,n=t.transaction(p.A.BOOKMARK_OBJECT_STORE_NAME,"readwrite"),o=n.objectStore(p.A.BOOKMARK_OBJECT_STORE_NAME),e.abrupt("return",o.put(h(h({},r),{},{createdAt:(new Date).toISOString()})));case 9:throw e.prev=9,e.t0=e.catch(0),console.error("Error adding bookmark:",e.t0),e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e){return t.apply(this,arguments)})},{key:"removeBookmark",value:(r=(0,o.A)(i().mark((function e(r){var t,n,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._dbPromise;case 3:return t=e.sent,n=t.transaction(p.A.BOOKMARK_OBJECT_STORE_NAME,"readwrite"),o=n.objectStore(p.A.BOOKMARK_OBJECT_STORE_NAME),e.abrupt("return",o.delete(r));case 9:throw e.prev=9,e.t0=e.catch(0),console.error("Error removing bookmark:",e.t0),e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e){return r.apply(this,arguments)})},{key:"isBookmarked",value:(e=(0,o.A)(i().mark((function e(r){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getBookmark(r);case 3:return t=e.sent,e.abrupt("return",!!t);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error checking bookmark:",e.t0),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(r){return e.apply(this,arguments)})}]);var e,r,t,n,c,l}())},263:(e,r,t)=>{e.exports=t.p+"images/dlogoee13974096acf2b65cdf.png"},559:(e,r,t)=>{t.d(r,{A:()=>n});const n={BASE_URL:"https://story-api.dicoding.dev/v1",VAPID_PUBLIC_KEY:"BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk",DEFAULT_MAP_CENTER:[-6.2088,106.8456],DEFAULT_MAP_ZOOM:5,CACHE_NAME:"dicoding-story-v1",DATABASE_NAME:"dicoding-story-database",DATABASE_VERSION:1,BOOKMARK_DATABASE_NAME:"dicoding-story-bookmarks",BOOKMARK_OBJECT_STORE_NAME:"bookmarks",OBJECT_STORE_NAME:"stories",MAX_FILE_SIZE:1048576,API_TIMEOUT:8e3}},702:(e,r,t)=>{t.d(r,{A:()=>u});var n=t(467),o=t(29),a=t(901),s=t(756),c=t.n(s),i=t(922);const u=function(){return(0,a.A)((function e(){(0,o.A)(this,e)}),null,[{key:"isUserLoggedIn",value:function(){return!!this.getUserToken()}},{key:"getUserToken",value:function(){return localStorage.getItem("token")}},{key:"getUserName",value:function(){return localStorage.getItem("name")}},{key:"register",value:(r=(0,n.A)(c().mark((function e(r){var t,n,o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.name,n=r.email,o=r.password,e.next=3,i.A.register({name:t,email:n,password:o});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"login",value:(e=(0,n.A)(c().mark((function e(r){var t,n,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.email,n=r.password,e.next=3,i.A.login({email:t,password:n});case 3:return o=e.sent,localStorage.setItem("token",o.loginResult.token),localStorage.setItem("name",o.loginResult.name),localStorage.setItem("userId",o.loginResult.userId),window.location.hash="#/",e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)}))),function(r){return e.apply(this,arguments)})},{key:"logout",value:function(){localStorage.removeItem("token"),localStorage.removeItem("name"),localStorage.removeItem("userId"),window.location.hash="#/login"}}]);var e,r}()},922:(e,r,t)=>{t.d(r,{A:()=>h});var n=t(848),o=t(467),a=t(29),s=t(901),c=t(756),i=t.n(c),u=t(559);function p(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function l(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?p(Object(t),!0).forEach((function(r){(0,n.A)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}const h=function(){return(0,s.A)((function e(){(0,a.A)(this,e)}),null,[{key:"_handleResponse",value:(v=(0,o.A)(i().mark((function e(r){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.json();case 2:if(t=e.sent,r.ok){e.next=6;break}throw n=t.message||"Request failed with status ".concat(r.status),new Error(n);case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"_fetchWithTimeout",value:(d=(0,o.A)(i().mark((function e(r){var t,n,o,a,s,c,p=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(t=p.length>1&&void 0!==p[1]?p[1]:{}).timeout,o=void 0===n?u.A.API_TIMEOUT:n,a=new AbortController,s=setTimeout((function(){return a.abort()}),o),e.prev=4,e.next=7,fetch(r,l(l({},t),{},{signal:a.signal}));case 7:return c=e.sent,clearTimeout(s),e.abrupt("return",c);case 12:if(e.prev=12,e.t0=e.catch(4),clearTimeout(s),"AbortError"!==e.t0.name){e.next=17;break}throw new Error("Request timeout. Please check your connection and try again.");case 17:throw new Error("Network error. Please check your internet connection.");case 18:case"end":return e.stop()}}),e,null,[[4,12]])}))),function(e){return d.apply(this,arguments)})},{key:"register",value:(f=(0,o.A)(i().mark((function e(r){var t,n,o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.name,n=r.email,o=r.password,e.prev=1,e.next=4,this._fetchWithTimeout("".concat(u.A.BASE_URL,"/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,email:n,password:o})});case 4:return a=e.sent,e.abrupt("return",this._handleResponse(a));case 8:throw e.prev=8,e.t0=e.catch(1),console.error("Registration error:",e.t0),new Error(e.t0.message||"Registration failed. Please try again.");case 12:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e){return f.apply(this,arguments)})},{key:"login",value:(h=(0,o.A)(i().mark((function e(r){var t,n,o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.email,n=r.password,e.prev=1,e.next=4,this._fetchWithTimeout("".concat(u.A.BASE_URL,"/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:n})});case 4:return o=e.sent,e.next=7,this._handleResponse(o);case 7:if((a=e.sent).loginResult&&a.loginResult.token){e.next=10;break}throw new Error("Invalid response from server");case 10:return e.abrupt("return",a);case 13:throw e.prev=13,e.t0=e.catch(1),console.error("Login error:",e.t0),new Error(e.t0.message||"Login failed. Please check your credentials.");case 17:case"end":return e.stop()}}),e,this,[[1,13]])}))),function(e){return h.apply(this,arguments)})},{key:"getAllStories",value:(p=(0,o.A)(i().mark((function e(r){var t,n,o,a,s,c,p,l,h;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.token,n=r.page,o=void 0===n?1:n,a=r.size,s=void 0===a?10:a,c=r.location,p=void 0===c?0:c,e.prev=1,e.next=4,this._fetchWithTimeout("".concat(u.A.BASE_URL,"/stories?page=").concat(o,"&size=").concat(s,"&location=").concat(p),{headers:{Authorization:"Bearer ".concat(t)}});case 4:return l=e.sent,e.next=7,this._handleResponse(l);case 7:if(h=e.sent,Array.isArray(h.listStory)){e.next=10;break}throw new Error("Invalid stories data format");case 10:return e.abrupt("return",h.listStory);case 13:throw e.prev=13,e.t0=e.catch(1),console.error("Error fetching stories:",e.t0),new Error(e.t0.message||"Failed to load stories. Please try again.");case 17:case"end":return e.stop()}}),e,this,[[1,13]])}))),function(e){return p.apply(this,arguments)})},{key:"getStoryDetail",value:(c=(0,o.A)(i().mark((function e(r,t){var n,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._fetchWithTimeout("".concat(u.A.BASE_URL,"/stories/").concat(r),{headers:{Authorization:"Bearer ".concat(t)}});case 3:return n=e.sent,e.next=6,this._handleResponse(n);case 6:if((o=e.sent).story){e.next=9;break}throw new Error("Story not found");case 9:return e.abrupt("return",o.story);case 12:throw e.prev=12,e.t0=e.catch(0),console.error("Error fetching story detail:",e.t0),new Error(e.t0.message||"Failed to load story details.");case 16:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e,r){return c.apply(this,arguments)})},{key:"addNewStory",value:(n=(0,o.A)(i().mark((function e(r){var t,n,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.token,n=r.data,e.prev=1,n instanceof FormData){e.next=4;break}throw new Error("Invalid data format");case 4:return e.next=6,this._fetchWithTimeout("".concat(u.A.BASE_URL,"/stories"),{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:n});case 6:return o=e.sent,e.abrupt("return",this._handleResponse(o));case 10:throw e.prev=10,e.t0=e.catch(1),console.error("Error adding story:",e.t0),new Error(e.t0.message||"Failed to add story. Please try again.");case 14:case"end":return e.stop()}}),e,this,[[1,10]])}))),function(e){return n.apply(this,arguments)})},{key:"addNewStoryGuest",value:(t=(0,o.A)(i().mark((function e(r){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.data,e.prev=1,e.next=4,this._fetchWithTimeout("".concat(u.A.BASE_URL,"/stories/guest"),{method:"POST",body:t});case 4:return n=e.sent,e.abrupt("return",this._handleResponse(n));case 8:throw e.prev=8,e.t0=e.catch(1),console.error("Error adding guest story:",e.t0),new Error(e.t0.message||"Failed to add story. Please try again.");case 12:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e){return t.apply(this,arguments)})},{key:"subscribePushNotification",value:(r=(0,o.A)(i().mark((function e(r){var t,n,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.token,n=r.subscription,e.prev=1,e.next=4,this._fetchWithTimeout("".concat(u.A.BASE_URL,"/notifications/subscribe"),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify(n)});case 4:return o=e.sent,e.abrupt("return",this._handleResponse(o));case 8:throw e.prev=8,e.t0=e.catch(1),console.error("Error subscribing to notifications:",e.t0),new Error(e.t0.message||"Failed to subscribe to notifications.");case 12:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e){return r.apply(this,arguments)})},{key:"unsubscribePushNotification",value:(e=(0,o.A)(i().mark((function e(r){var t,n,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.token,n=r.endpoint,e.prev=1,e.next=4,this._fetchWithTimeout("".concat(u.A.BASE_URL,"/notifications/subscribe"),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({endpoint:n})});case 4:return o=e.sent,e.abrupt("return",this._handleResponse(o));case 8:throw e.prev=8,e.t0=e.catch(1),console.error("Error unsubscribing from notifications:",e.t0),new Error(e.t0.message||"Failed to unsubscribe from notifications.");case 12:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(r){return e.apply(this,arguments)})}]);var e,r,t,n,c,p,h,f,d,v}()},965:(e,r,t)=>{t.d(r,{A:()=>v});var n=t(75),o=t(467),a=t(29),s=t(901),c=t(756),i=t.n(c),u=t(922),p=t(559);const l=new(function(){return(0,s.A)((function e(){(0,a.A)(this,e),this._dbPromise=this._openDB()}),[{key:"_openDB",value:function(){return new Promise((function(e,r){var t=indexedDB.open(p.A.DATABASE_NAME,p.A.DATABASE_VERSION);t.onupgradeneeded=function(e){var r=e.target.result;if(!r.objectStoreNames.contains(p.A.OBJECT_STORE_NAME)){var t=r.createObjectStore(p.A.OBJECT_STORE_NAME,{keyPath:"id"});t.createIndex("createdAt","createdAt",{unique:!1}),t.createIndex("name","name",{unique:!1})}r.objectStoreNames.contains("bookmarks")||r.createObjectStore("bookmarks",{keyPath:"id"}).createIndex("storyId","storyId",{unique:!0})},t.onsuccess=function(){e(t.result)},t.onerror=function(e){console.error("Database error:",e.target.error),r(e.target.error)}}))}},{key:"getStory",value:(d=(0,o.A)(i().mark((function e(r){var t,n,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._dbPromise;case 3:return t=e.sent,n=t.transaction(p.A.OBJECT_STORE_NAME,"readonly"),o=n.objectStore(p.A.OBJECT_STORE_NAME),e.abrupt("return",o.get(r));case 9:throw e.prev=9,e.t0=e.catch(0),console.error("Error getting story:",e.t0),e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e){return d.apply(this,arguments)})},{key:"getAllStories",value:(f=(0,o.A)(i().mark((function e(){var r,t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._dbPromise;case 3:return r=e.sent,t=r.transaction(p.A.OBJECT_STORE_NAME,"readonly"),n=t.objectStore(p.A.OBJECT_STORE_NAME),e.abrupt("return",n.getAll());case 9:throw e.prev=9,e.t0=e.catch(0),console.error("Error getting all stories:",e.t0),e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(){return f.apply(this,arguments)})},{key:"putStory",value:(h=(0,o.A)(i().mark((function e(r){var t,n,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._dbPromise;case 3:return t=e.sent,n=t.transaction(p.A.OBJECT_STORE_NAME,"readwrite"),o=n.objectStore(p.A.OBJECT_STORE_NAME),e.abrupt("return",o.put(r));case 9:throw e.prev=9,e.t0=e.catch(0),console.error("Error putting story:",e.t0),e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e){return h.apply(this,arguments)})},{key:"putStories",value:(l=(0,o.A)(i().mark((function e(r){var t,n,o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._dbPromise;case 3:return t=e.sent,n=t.transaction(p.A.OBJECT_STORE_NAME,"readwrite"),o=n.objectStore(p.A.OBJECT_STORE_NAME),a=r.map((function(e){return o.put(e)})),e.next=9,Promise.all(a);case 9:return e.abrupt("return",n.complete);case 12:throw e.prev=12,e.t0=e.catch(0),console.error("Error putting stories:",e.t0),e.t0;case 16:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e){return l.apply(this,arguments)})},{key:"deleteStory",value:(u=(0,o.A)(i().mark((function e(r){var t,n,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._dbPromise;case 3:return t=e.sent,n=t.transaction(p.A.OBJECT_STORE_NAME,"readwrite"),o=n.objectStore(p.A.OBJECT_STORE_NAME),e.abrupt("return",o.delete(r));case 9:throw e.prev=9,e.t0=e.catch(0),console.error("Error deleting story:",e.t0),e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e){return u.apply(this,arguments)})},{key:"clearStories",value:(c=(0,o.A)(i().mark((function e(){var r,t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._dbPromise;case 3:return r=e.sent,(t=r.transaction(p.A.OBJECT_STORE_NAME,"readwrite")).objectStore(p.A.OBJECT_STORE_NAME).clear(),e.abrupt("return",t.complete);case 10:throw e.prev=10,e.t0=e.catch(0),console.error("Error clearing stories:",e.t0),e.t0;case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return c.apply(this,arguments)})},{key:"getBookmarks",value:(n=(0,o.A)(i().mark((function e(){var r,t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._dbPromise;case 3:return r=e.sent,t=r.transaction("bookmarks","readonly"),n=t.objectStore("bookmarks"),e.abrupt("return",n.getAll());case 9:throw e.prev=9,e.t0=e.catch(0),console.error("Error getting bookmarks:",e.t0),e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(){return n.apply(this,arguments)})},{key:"addBookmark",value:(t=(0,o.A)(i().mark((function e(r){var t,n,o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._dbPromise;case 3:return t=e.sent,n=t.transaction("bookmarks","readwrite"),o=n.objectStore("bookmarks"),a={id:"bookmark_".concat(r.id),storyId:r.id,storyData:r,createdAt:(new Date).toISOString()},e.abrupt("return",o.add(a));case 10:throw e.prev=10,e.t0=e.catch(0),console.error("Error adding bookmark:",e.t0),e.t0;case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(e){return t.apply(this,arguments)})},{key:"removeBookmark",value:(r=(0,o.A)(i().mark((function e(r){var t,n,o,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._dbPromise;case 3:return t=e.sent,n=t.transaction("bookmarks","readwrite"),o=n.objectStore("bookmarks"),a=o.index("storyId"),s=a.get(r),e.abrupt("return",new Promise((function(e,r){s.onsuccess=function(){var r=s.result;e(!!r&&o.delete(r.id))},s.onerror=function(){r(s.error)}})));case 11:throw e.prev=11,e.t0=e.catch(0),console.error("Error removing bookmark:",e.t0),e.t0;case 15:case"end":return e.stop()}}),e,this,[[0,11]])}))),function(e){return r.apply(this,arguments)})},{key:"isBookmarked",value:(e=(0,o.A)(i().mark((function e(r){var t,n,o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._dbPromise;case 3:return t=e.sent,n=t.transaction("bookmarks","readonly"),o=n.objectStore("bookmarks"),a=o.index("storyId"),e.abrupt("return",new Promise((function(e){var t=a.get(r);t.onsuccess=function(){e(!!t.result)},t.onerror=function(){e(!1)}})));case 10:return e.prev=10,e.t0=e.catch(0),console.error("Error checking bookmark:",e.t0),e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(r){return e.apply(this,arguments)})}]);var e,r,t,n,c,u,l,h,f,d}());var h=t(702);function f(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(e){if("string"==typeof e)return d(e,r);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?d(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==t.return||t.return()}finally{if(c)throw a}}}}function d(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=Array(r);t<r;t++)n[t]=e[t];return n}const v=function(){return(0,s.A)((function e(){(0,a.A)(this,e)}),null,[{key:"getAllStories",value:(t=(0,o.A)(i().mark((function e(r){var t,n,o,a,s,c,p,f,d;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.page,n=void 0===t?1:t,o=r.size,a=void 0===o?10:o,s=r.location,c=void 0===s?0:s,e.prev=1,p=h.A.getUserToken(),e.next=5,u.A.getAllStories({token:p,page:n,size:a,location:c});case 5:if(!((f=e.sent).length>0)){e.next=15;break}return e.prev=7,e.next=10,l.putStories(f);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(7),console.error("Failed to cache stories:",e.t0);case 15:return e.abrupt("return",f);case 18:return e.prev=18,e.t1=e.catch(1),console.error("Failed to fetch stories from API:",e.t1),e.prev=21,e.next=24,l.getAllStories();case 24:if(!((d=e.sent).length>0)){e.next=27;break}return e.abrupt("return",d);case 27:e.next=32;break;case 29:e.prev=29,e.t2=e.catch(21),console.error("Failed to get cached stories:",e.t2);case 32:throw e.t1;case 33:case"end":return e.stop()}}),e,null,[[1,18],[7,12],[21,29]])}))),function(e){return t.apply(this,arguments)})},{key:"getStoryDetail",value:(r=(0,o.A)(i().mark((function e(r){var t,n,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=h.A.getUserToken(),e.next=4,u.A.getStoryDetail(r,t);case 4:return n=e.sent,e.prev=5,e.next=8,l.putStory(n);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),console.error("Failed to cache story:",e.t0);case 13:return e.abrupt("return",n);case 16:return e.prev=16,e.t1=e.catch(0),console.error("Failed to fetch story detail from API:",e.t1),e.prev=19,e.next=22,l.getStory(r);case 22:if(!(o=e.sent)){e.next=25;break}return e.abrupt("return",o);case 25:e.next=30;break;case 27:e.prev=27,e.t2=e.catch(19),console.error("Failed to get cached story:",e.t2);case 30:throw e.t1;case 31:case"end":return e.stop()}}),e,null,[[0,16],[5,10],[19,27]])}))),function(e){return r.apply(this,arguments)})},{key:"addNewStory",value:(e=(0,o.A)(i().mark((function e(r){var t,o,a,s,c,p,l,d,v,A,b;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=r.description,o=r.photo,a=r.lat,s=r.lon,e.prev=1,c=h.A.getUserToken(),(p=new FormData).append("description",t),p.append("photo",o),a&&s&&(p.append("lat",a),p.append("lon",s)),l=f(p.entries());try{for(l.s();!(d=l.n()).done;)v=(0,n.A)(d.value,2),A=v[0],b=v[1],console.log(A,b)}catch(e){l.e(e)}finally{l.f()}if(!c){e.next=13;break}return e.next=12,u.A.addNewStory({token:c,data:p});case 12:case 15:return e.abrupt("return",e.sent);case 13:return e.next=15,u.A.addNewStoryGuest({data:p});case 18:throw e.prev=18,e.t0=e.catch(1),console.error("Error adding new story:",e.t0),new Error(e.t0.message||"Failed to add story. Please try again.");case 22:case"end":return e.stop()}}),e,null,[[1,18]])}))),function(r){return e.apply(this,arguments)})}]);var e,r,t}()}}]);
//# sourceMappingURL=app~7bd12dde.88fecfe5904efd24bcbe.bundle.js.map